<script>
  function autoplayCarousel() {
    const carouselEl = document.getElementById("carousel")!;
    const slideContainerEl = carouselEl.querySelector(
      "#slide-container"
    ) as HTMLDivElement;
    const slideEl = carouselEl.querySelector(".slide") as HTMLDivElement;
    let slideWidth = slideEl.offsetWidth;
    // Add click handlers
    document
      .querySelector("#back-button")!
      .addEventListener("click", () => navigate("backward"));
    document
      .querySelector("#forward-button")!
      .addEventListener("click", () => navigate("forward"));
    document.querySelectorAll(".slide-indicator").forEach((dot, index) => {
      dot.addEventListener("click", () => navigate(index));
      dot.addEventListener("mouseenter", () => clearInterval(autoplay));
    });
    // Add keyboard handlers
    document.addEventListener("keydown", (e) => {
      if (e.code === "ArrowLeft") {
        clearInterval(autoplay);
        navigate("backward");
      } else if (e.code === "ArrowRight") {
        clearInterval(autoplay);
        navigate("forward");
      }
    });
    // Add resize handler
    window.addEventListener("resize", () => {
      slideWidth = slideEl.offsetWidth;
    });
    // Autoplay
    const autoplay = setInterval(() => navigate("forward"), 3000);
    slideContainerEl.addEventListener("mouseenter", () =>
      clearInterval(autoplay)
    );
    // Slide transition
    const getNewScrollPosition = (arg: number | "forward" | "backward") => {
      const gap = 10;
      const maxScrollLeft = slideContainerEl.scrollWidth - slideWidth;
      if (arg === "forward") {
        const x = slideContainerEl.scrollLeft + slideWidth + gap;
        return x <= maxScrollLeft ? x : 0;
      } else if (arg === "backward") {
        const x = slideContainerEl.scrollLeft - slideWidth - gap;
        return x >= 0 ? x : maxScrollLeft;
      } else if (typeof arg === "number") {
        const x = arg * (slideWidth + gap);
        return x;
      }
    };
    const navigate = (arg: number | "forward" | "backward") => {
      slideContainerEl.scrollLeft = getNewScrollPosition(arg) as number;
    };
    // Slide indicators
    const slideObserver = new IntersectionObserver(
      (entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const slideIndex = (entry.target as HTMLElement).dataset.slideindex;
            carouselEl
              .querySelector(".slide-indicator.active")!
              .classList.remove("active");
            const slideIndicators =
              carouselEl.querySelectorAll(".slide-indicator");
            // @ts-ignore
            slideIndicators[slideIndex].classList.add("active");
          }
        });
      },
      { root: slideContainerEl, threshold: 0.1 }
    );
    document.querySelectorAll(".slide").forEach((slide) => {
      slideObserver.observe(slide);
    });
  }
  autoplayCarousel();
</script>
<div id="carousel" class="">
  <div id="slide-container" class="no-scrollbar rounded-2xl w-96 h-96">
    <div class="slide h-[504px]" data-slideindex="0">
      <!-- <div class="slide-banner">
                Tour the Empire State Building! <a href="">Buy tickets now.</a>
              </div> -->
      <!-- TODO: Devsite - remove referrers to web-dev.imgix.net -->
      <img
        width="1200"
        height="600"
        src="https://web-dev.imgix.net/image/j2RDdG43oidUy6AL6LovThjeX9c2/d5JiF2JjxniJRH6xviYA.jpg"
      />
    </div>
    <div class="slide h-[504px]" data-slideindex="1">
      <!-- <div class="slide-banner">
                Ride the Shinkansen! <a href="">Buy tickets now.</a>
              </div> -->
      <!-- TODO: Devsite - remove referrers to web-dev.imgix.net -->
      <img
        width="1200"
        height="600"
        src="https://web-dev.imgix.net/image/j2RDdG43oidUy6AL6LovThjeX9c2/atRogpxlJTXAvhWe654i.jpg"
      />
    </div>
    <div class="slide h-[504px]" data-slideindex="2">
      <!-- <div class="slide-banner">
                Discover relaxation! <a href="">Buy tickets now.</a>
              </div> -->
      <!-- TODO: Devsite - remove referrers to web-dev.imgix.net -->
      <img
        width="1200"
        height="600"
        src="https://web-dev.imgix.net/image/j2RDdG43oidUy6AL6LovThjeX9c2/q8svpF1B6dG5wNuiTgyV.jpg"
      />
    </div>
    <div class="slide h-[504px]" data-slideindex="3">
      <!-- <div class="slide-banner">
                See penguins! <a href="">Buy tickets now.</a>
              </div> -->
      <!-- TODO: Devsite - remove referrers to web-dev.imgix.net -->
      <img
        width="1200"
        height="600"
        src="https://web-dev.imgix.net/image/j2RDdG43oidUy6AL6LovThjeX9c2/oweFaoCZ4g8bieZdvG5L.jpg"
      />
    </div>
    <div class="slide h-[504px]" data-slideindex="4">
      <!-- <div class="slide-banner">
                Take a ride on the wheel! <a href="">Buy tickets now.</a>
              </div> -->
      <!-- TODO: Devsite - remove referrers to web-dev.imgix.net -->
      <img
        width="1200"
        height="600"
        src="https://web-dev.imgix.net/image/j2RDdG43oidUy6AL6LovThjeX9c2/G0aWgHwWJTPZus9YEMyH.jpg"
      />
    </div>
  </div>
  <div id="back-button" class="arrow back">←</div>
  <div id="forward-button" class="arrow forward">→</div>
  <div class="slide-indicators absolute -bottom-12 w-full">
    <div class="slide-indicator"></div>
    <div class="slide-indicator"></div>
    <div class="slide-indicator active"></div>
    <div class="slide-indicator"></div>
    <div class="slide-indicator"></div>
  </div>
</div>
<style>
  #carousel {
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    margin: 0 auto;
    position: relative;
  }
  .slide-indicators {
    display: flex;
    justify-content: center;
  }
  .slide-indicator {
    height: 44px;
    width: 50px;
    display: flex;
    justify-items: center;
    cursor: pointer;
  }
  .slide-indicator:after {
    content: "";
    background-color: #878787;
    height: 10px;
    margin-top: 10px;
    width: 40px;
  }
  .slide-indicator.active:after,
  .slide-indicator:hover:after {
    background-color: #000;
  }
  .slide-banner {
    background-color: #000;
    color: #fff;
    position: absolute;
    left: 0;
    bottom: 20px;
    padding: 15px;
    font-size: 2.5vw;
  }
  .slide-banner a {
    color: #fff;
  }
  #slide-container {
    scroll-snap-type: x mandatory;
    overflow-x: scroll;
    overflow-y: hidden;
    display: flex;
    align-items: center;
    height: 100%;
    gap: 10px;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  .slide {
    scroll-snap-align: center;
    position: relative;
    min-width: 100%;
    padding-top: 50%;
  }
  .slide img {
    height: 100%;
    width: auto;
    position: absolute;
    top: 0;
    left: 0;
  }
  .arrow {
    color: #fff;
    height: 20px;
    width: 20px;
    background-color: #000;
    position: absolute;
    padding: 10px;
    opacity: 0.3;
    cursor: pointer;
  }
  .arrow.back {
    left: 10px;
    top: 10px;
  }
  .arrow.forward {
    right: 10px;
    top: 10px;
  }
  .arrow:hover {
    opacity: 1;
  }
</style>
